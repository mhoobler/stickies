!function(){const e=async()=>new Promise(((e,t)=>{var o,n=indexedDB.open("stickiesDB",1);n.onerror=e=>{console.error("IndexedDB error"),t("Error with creating request")},n.onsuccess=async t=>{console.log(t),(o=t.target.result).onerror=e=>{console.error("Database error: "+e.target.errorCode)};try{const t=(await(async e=>new Promise(((t,o)=>{var n=e.transaction(["stickies"],"readwrite");n.oncomplete=e=>{console.log("transaction success",e)},n.onerror=e=>{console.error("transaction error",e)},n?t(n):o("Error with creating transaction")})))(o)).objectStore("stickies");e({store:t})}catch(e){console.log(e)}},n.onupgradeneeded=e=>{var t=e.target.result.createObjectStore("stickies",{autoIncrement:!0,keyPath:"id"});t.createIndex("id","id",{unique:!0}),t.createIndex("message","message",{unique:!1}),t.createIndex("color","color",{unique:!1}),t.createIndex("left","left",{unique:!1}),t.createIndex("top","top",{unique:!1})}})),t=document.getElementById("App"),o=document.getElementById("color-select"),n=document.getElementById("color-options"),r=document.getElementById("sticky-container"),s=document.getElementById("trash"),c=document.getElementById("trash").querySelector("path");document.getElementById("hidden");function l({color:t,top:o,left:n},r){e().then((e=>{const s=e.store.add({color:t,top:o,left:n,message:""});s.onsuccess=e=>{console.log("add sticky: ",e.target.result),r.dataset.id=e.target.result},s.onerror=e=>{console.log(e)}})).catch((e=>console.error(e)))}function a({id:t,color:o,top:n,left:r,message:s}){e().then((e=>{const c=e.store.put({id:t,color:o,top:n,left:r,message:s});c.onsuccess=e=>{console.log(e.target.result)},c.onerror=e=>{console.log(e)}})).catch((e=>console.error(e)))}document.body.removeChild;function*d(){let e=0;for(;;)yield e++}var i=d();document.getElementById("reset").addEventListener("click",(()=>{const e=[...document.querySelectorAll(".sticky")];for(let t of e)t.style.zIndex=0;i=d()}));const u={selectedColor:()=>o.getAttribute("data-color"),showingOptions:()=>!n.classList.contains("hidden"),zIndex:()=>i.next().value,getOffset:e=>{var{top:t,left:o}=e.style;return{top:t=parseInt(t.slice(0,-2)),left:o=parseInt(o.slice(0,-2))}},dragging:null};function g(e){const{tag:t,classList:o,id:n,value:r,style:s,dataset:c}=e,l=document.createElement(t);if(o&&(l.classList=o),n&&(l.id=n),r&&(l.value=r),s)for(let e of Object.keys(s))l.style[e]=s[e];if(c)for(let e of Object.keys(c))l.dataset[e]=c[e];return l}function m(e,t,o,n=null,r=null){const s=g({tag:"div",classList:"sticky",style:{top:"string"==typeof t?t:t+"px",left:"string"==typeof o?o:o+"px",zIndex:u.zIndex()},dataset:{id:e,color:n||u.selectedColor()}}),c=g({tag:"div"}),l=g({tag:"textarea",value:r});return l.onkeydown=((e,t=1e3)=>{let o;return n=>{console.log(e),clearTimeout(o),o=setTimeout((()=>{e(n)}),t)}})((e=>{const t=e.target.parentElement,{top:o,left:n}=t.style,{id:r,color:s}=t.dataset,{value:c}=e.target;a({id:parseInt(r),top:o,left:n,color:s,message:c})})),s.appendChild(c),s.appendChild(l),s.draggable,s.addEventListener("touchstart",p),s.addEventListener("mousedown",f),s}function p(e){if("TEXTAREA"!==e.target.tagName){const r=e.currentTarget;u.dragging=r;const{top:s,left:l}=u.getOffset(r);console.log(e.targetTouches[0]);const d=l-e.targetTouches[0].pageX,i=s-e.targetTouches[0].pageY,g=c.getBoundingClientRect();var t,o;function n(e){t=e.targetTouches[0].pageX,o=e.targetTouches[0].pageY;const{x:n,y:s,width:l,height:a}=g;c.style.fill=t>n&&t<n+l&&o>s&&o<s+a?"#F33":"",r.style.top=i+o+"px",r.style.left=d+t+"px"}g.x=Math.floor(g.x),g.y=Math.floor(g.y),r.addEventListener("touchmove",n),r.addEventListener("touchend",(function e(s){console.log(s);const{x:l,y:d,width:i,height:m}=g,f=r.querySelector("textarea").value,{top:v,left:h}=r.style,{id:y,color:E}=r.dataset;if(t>l&&t<l+i&&o>d&&o<d+m)return c.style.fill="#F33",void L();u.dragging=null,a({id:parseInt(y),top:v,left:h,message:f,color:E}),r.removeEventListener("touchmove",n),r.removeEventListener("touchend",e),r.addEventListener("touchstart",p)})),r.removeEventListener("touchstart",p)}}function f(e){e.currentTarget.style.zIndex=u.zIndex();const{height:o,width:n}=t.getBoundingClientRect();if("TEXTAREA"!==e.target.tagName){const n=e.currentTarget;u.dragging=n;const{top:s,left:c}=u.getOffset(n),l=c-e.pageX,d=s-e.pageY;function r(e){console.log(e),t.style.height=o+"px",t.style.width=o+"px",n.style.top=d+e.pageY+"px",n.style.left=l+e.pageX+"px"}n.addEventListener("mousemove",r),n.addEventListener("mouseup",(function e(o){t.style.height="",t.style.width="",u.dragging=null;const s=o.currentTarget.querySelector("textarea").value,{top:c,left:l}=o.currentTarget.style,{id:d,color:i}=o.currentTarget.dataset;a({id:parseInt(d),top:c,left:l,message:s,color:i}),n.removeEventListener("mousemove",r),n.removeEventListener("mouseup",e)}))}}var v;function h(e){console.log("d"),v=setTimeout((()=>{const t=m(0,e.pageY,e.pageX);function o(e){t.style.top=e.pageY+"px",t.style.left=e.pageX+"px"}r.appendChild(t),u.dragging=t,document.addEventListener("mousemove",o),document.addEventListener("mouseup",(function e(n){u.dragging=null,l({top:n.pageY,left:n.pageX,color:u.selectedColor()},t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e)}))}),200)}function y(e){v&&clearTimeout(v);const t=e.target.dataset.color;e.currentTarget.setAttribute("data-color",t),n.classList.toggle("hidden")}function E(e){v&&clearTimeout(v);const t=e.target.dataset.color;e.currentTarget.setAttribute("data-color",t),n.classList.toggle("hidden")}function L(){if(u.dragging){window.confirm("Are you sure you want to delete this?")&&(t=u.dragging.dataset.id,e().then((e=>{const o=e.store.delete(parseInt(t));o.onsuccess=e=>{console.log(e.target.result)},o.onerror=e=>{console.log(e)}})).catch((e=>console.error(e))),u.dragging.remove(),u.dragging=null,c.style.fill="")}var t}o.addEventListener("mouseup",E),o.addEventListener("mousedown",h),o.addEventListener("touchstart",(function(e){o.removeEventListener("mouseup",E),o.removeEventListener("mousedown",h),v=setTimeout((()=>{const t=m(0,e.targetTouches[0].pageY,e.targetTouches[0].pageX);function n(e){t.style.top=e.targetTouches[0].pageY+"px",t.style.left=e.targetTouches[0].pageX+"px",o.removeEventListener("touchend",y)}r.appendChild(t),document.addEventListener("touchmove",n),document.addEventListener("touchend",(function e(r){v=null,l({top:t.style.top,left:t.style.left,color:u.selectedColor()},t),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",e),o.removeEventListener("touchend",y),o.addEventListener("touchend",y)}))}),200)})),o.addEventListener("touchend",y),s.addEventListener("mouseenter",(function(e){u.dragging&&(c.style.fill="#F33")})),s.addEventListener("mouseleave",(function(e){c.style.fill=""})),s.addEventListener("mouseup",L),s.addEventListener("touchstart",(e=>{c.style.fill="#F33"})),s.addEventListener("touchend",(e=>{c.style.fill=""})),e().then((e=>{const t=e.store.getAll();t.onsuccess=e=>{const t=e.target.result;for(let e of t){let t=m(e.id,e.top,e.left,e.color,e.message);r.appendChild(t)}},t.onerror=e=>{console.log(e)}})).catch((e=>console.error(e)))}();
//# sourceMappingURL=index.3b604595.js.map
